![å°é¢](https://upload-images.jianshu.io/upload_images/953327-932c895fc9082c94.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

# å‰è¨€

åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¾ˆå¤šåœºæ™¯éƒ½éœ€è¦ç”¨åˆ°å‰ç«¯æŠŠæ•°æ®ç¼“å­˜åœ¨ç«¯ä¸Šçš„èƒ½åŠ›

- ä¸šåŠ¡æšä¸¾ã€æ ‡ç­¾ã€é…ç½®ä¿¡æ¯
- ä½¿ç”¨åº”ç”¨æœŸé—´äº§ç”Ÿçš„åº”ç”¨/é…ç½®æ•°æ®
- å•ç”¨æˆ·åŸºç¡€ä¿¡æ¯
- æ ¹æ®ç”¨æˆ·éš”ç¦»çš„ç¼“å­˜æ•°æ®
- éšä¸šåŠ¡æ´»åŠ¨å¢é•¿çš„æ•°æ®ç¼“å­˜
- ç‰¹æ®Šåœºæ™¯çš„äºŒè¿›åˆ¶ã€åª’ä½“æ•°æ®

å‰ç«¯å¼€å‘è€…å¸¸å¸¸ä¼šé€‰æ‹©ç”¨`localStorage`æ¥å­˜å‚¨éœ€è¦ç¼“å­˜åˆ°å‰ç«¯çš„æ•°æ®ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½é€‚åˆç”¨è¿™ä¸ªæ¥ç®¡ç†ç¼“å­˜ï¼Œæ»¥ç”¨è¿˜ä¼šå¯¼è‡´å› ç¼“å­˜æ•°æ®åŠ¨ä½œå¤±è´¥äº§ç”Ÿçº¿ä¸Šé—®é¢˜ã€‚

é’ˆå¯¹ä¸åŒä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬åº”è¯¥é€‰æ‹©ä¸åŒçš„æ–¹æ¡ˆå»ç¼“å­˜æ•°æ®ã€‚æœ¬æ–‡å°±é’ˆå¯¹æœ€å¸¸è§çš„å­˜å‚¨æ–¹æ¡ˆå’Œåœºæ™¯åšä¸€äº›åˆ†ç±»å’Œä»‹ç»ä¸€äº›åœ¨ `Vue/React` ä¸­çš„é«˜é˜¶ç”¨æ³•ï¼ŒåŠ©åŠ›å‰ç«¯å¼€å‘ä½“éªŒå’Œåº”ç”¨çš„ç¨³å®šæ€§ã€‚åŒæ—¶ï¼Œç¼“å­˜é”®çš„å‘½åå’Œç®¡ç†ä¹Ÿæ˜¯å€¼å¾—å…³æ³¨çš„ã€‚

# å‰ç«¯ç¼“å­˜æ–¹æ¡ˆ

é™¤äº† `cookie`ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š

| ç‰¹æ€§ | **sessionStorage** | **localStorage** | **indexedDB** |
| --- | --- | --- | --- |
| æŒä¹…æ—¶æ•ˆ | å½“å‰ä¼šè¯æœŸ | æ°¸ä¹… | æ°¸ä¹… |
| å­˜å‚¨ç©ºé—´ | 5MB | 5MB | ä¾èµ–å¯ç”¨ç£ç›˜ç©ºé—´ |
| åŒæ­¥/å¼‚æ­¥ | åŒæ­¥ | åŒæ­¥ | å¼‚æ­¥ |

é’ˆå¯¹ä¸åŒçš„ç‰¹æ€§æˆ‘ä»¬å¯ä»¥å¾—çŸ¥å­˜å‚¨åˆ°`sessionStorage`å’Œ`localStorage`ä¸­çš„æ•°æ®ç”±äºå­˜å‚¨ç©ºé—´æœ‰é™éƒ½åº”ç¬¦åˆä»¥ä¸‹ç‰¹æ€§ï¼š
1. ç¼“å­˜**æ•°æ®æ¡ç›®å¿…é¡»å¯æ§**ï¼Œä¸å¯å­˜å‚¨**ç´¯ç§¯æ€§/çˆ†å‘æ€§å¢é•¿**æ€§è´¨çš„æ•°æ®
2. **å•ä¸ªæ¡ç›®æ•°æ®ä¸å¯è¿‡å¤§**ï¼Œå› æ­¤ä¸é€‚åˆå­˜å‚¨äºŒè¿›åˆ¶ç±»çš„æ•°æ®ï¼ˆä¾‹å¦‚å¤§æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰æ–‡ä»¶ï¼‰

è€Œå¯¹äº`indexedDB`ï¼Œåˆ™æ›´é€‚åˆå­˜å‚¨å¤§æ–‡ä»¶å’Œæ•°æ®æ¡ç›®è·Ÿéšä¸šåŠ¡æ“ä½œå¢é•¿çš„åœºæ™¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­˜å–æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ã€‚

# ç¡®å®šä¸åŒåœºæ™¯ç¼“å­˜æ–¹æ¡ˆ

- é’ˆå¯¹**ä¸šåŠ¡æšä¸¾ã€æ ‡ç­¾**ç±»çš„ï¼Œè¿™ç±»çš„ä¿¡æ¯å¾€å¾€éƒ½æ˜¯å­—å…¸æ•°æ®ï¼Œæ•°æ®é‡ä¸å¤§å¹¶ä¸”æ›´æ–°ä¸é¢‘ç¹ï¼Œæ›´æ–°å‰åæ”¹åŠ¨ä¹Ÿä¸å¤§ï¼Œè¿™ç±»ä¿¡æ¯æ˜¯å¯ä»¥å­˜å‚¨åˆ°`localStorage`ä¸­çš„
- **ä½¿ç”¨åº”ç”¨æœŸé—´äº§ç”Ÿçš„åº”ç”¨/é…ç½®æ•°æ®**ï¼šè¿™ä¸ªæ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹å°±å¯ä»¥ä½¿ç”¨`sessionStorage`ï¼Œå¦åˆ™åº”è¯¥è€ƒè™‘å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Œæ¯”å¦‚pinia
- **å•ç”¨æˆ·çš„åŸºç¡€ä¿¡æ¯**è¿™ç±»ä¿¡æ¯ä¸€èˆ¬æƒ…å†µæ˜¯ç”¨æˆ·åœ¨ç™»é™†æˆåŠŸä¹‹ååç«¯è¿”å›çš„ä¿¡æ¯ï¼Œè¿™ç±»ä¿¡æ¯æ¡ç›®ç¡®å®šï¼Œä¹Ÿé€‚åˆå­˜å‚¨åˆ°`localStorage`
- **æ ¹æ®ç”¨æˆ·éš”ç¦»çš„ç¼“å­˜æ•°æ®**ï¼šè¿™ä¸ªå¦‚æœç”¨`localStorage`å°±ä¸ç¬¦åˆæˆ‘ä»¬è¯´çš„**æ•°æ®æ¡ç›®å¿…é¡»å¯æ§**åŸåˆ™ï¼Œåº”è¯¥å­˜å‚¨åˆ°`indexedDB`ä¸­
- **éšä¸šåŠ¡æ´»åŠ¨å¢é•¿çš„æ•°æ®ç¼“å­˜**ï¼šè¿™ä¸ªæ¯‹åº¸ç½®ç–‘åº”è¯¥é€‰æ‹©ä½¿ç”¨`indexedDB`ï¼Œ`localStorage`è¿Ÿæ—©ä¼šçˆ†
- **ç‰¹æ®Šåœºæ™¯çš„äºŒè¿›åˆ¶ã€åª’ä½“æ•°æ®**ï¼šè¿™ä¸ªä¹Ÿåº”è¯¥é€‰æ‹©ä½¿ç”¨`indexedDB`

# è§„èŒƒ

åœ¨ä¸€ä¸ªåº”ç”¨ä¸­å¯¹äºæ‰€æœ‰ç¼“å­˜çš„keyéƒ½åº”è¯¥é›†ä¸­ç®¡ç†ï¼Œæ•°é‡å¤šäº†ä¹‹åè¦åšåˆ†çº§ç®¡ç†ï¼Œç”¨æšä¸¾æ¥ç®¡ç†ï¼Œé¿å…éšå¤„ç”¨éšå¤„èµ·åçš„åä¹ æƒ¯ã€‚

æˆ‘ä»¬å¯ä»¥å•ç‹¬æŠŠé¡¹ç›®ä½¿ç”¨åˆ°çš„å¸¸é‡å•ç‹¬ç»´æŠ¤, ä»ä¸€ä¸ªå‡ºå£æš´éœ²å‡ºå»
```bash
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ modules
â”‚   â”‚   â”œâ”€â”€ constant
â”‚   â”‚   â”‚   â””â”€â”€ cache.ts // ç¼“å­˜ç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ index.ts // å‡ºå£
```
ä¸¾ä¸ªğŸŒ°å­ï¼š
```typescript
// cache.ts
export enum CacheKeyEnum {
  USER_INFO = 'user-info',
  // ...
}

// index.ts
export * from './cache'

// ä½¿ç”¨
import { CacheKeyEnum } from '~/modules/constant'

function getUserCacheInfo() {
  return localStorage.getItem(CacheKeyEnum.USER_INFO)
}
```

è¿™æ ·åœ¨é¡¹ç›®ä¸­ç»Ÿä¸€ç®¡ç†`key`ä¼šè®©é¡¹ç›®æ›´æ˜“äºç»´æŠ¤ã€‚

# åœ¨é¡¹ç›®ä¸­æ›´ç®€æ˜“ã€ä¼˜é›…çš„æ“ä½œç¼“å­˜

## Vue
å¾—ç›Šäº[@vueuse](https://vueuse.org/)ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`useStorage`æ–¹æ³•æŠŠå¯¹`sessionStorage`å’Œ`localStorage`çš„æ“ä½œç®€åŒ–å¹¶ä¸”å’Œ`Vue`çš„å“åº”ç³»ç»Ÿç»“åˆï¼š

ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç¼“å­˜çš„`key`ï¼Œå¯¹åº”`setItem`çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºåˆå§‹æ•°æ®ï¼Œè¿”å›å€¼ä¸ºä¸€ä¸ª`Ref`ç±»å‹çš„å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥æ“ä½œ`state.value = { hello: "hello", greetinf: "Hi" }`å“åº”å¼æ›´æ”¹ç¼“å­˜ä¸­çš„å€¼ï¼Œä¸‹é¢æ˜¯ä¸€äº›æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼š
```typescript
import { useStorage } from '@vueuse/core'

// bind object
const state = useStorage('my-store', { hello: 'hi', greeting: 'Hello' })

// bind boolean
const flag = useStorage('my-flag', true) // returns Ref<boolean>

// bind number
const count = useStorage('my-count', 0) // returns Ref<number>

// bind string with SessionStorage
const id = useStorage('my-id', 'some-string-id', sessionStorage) // returns Ref<string>

// delete data from storage
state.value = null
```

## React
åŒæ ·çš„åœ¨Reactä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„åº“[react-use](https://github.com/streamich/react-use)ï¼Œå…¶ä¸­ä¹Ÿæœ‰[useLocalStorage](https://github.com/zenghongtu/react-use-chinese/blob/master/docs/useLocalStorage.md),å¯¹åº”çš„ç”¨æ³•ï¼š
```typescript
import {useLocalStorage} from 'react-use';

const Demo = () => {
  const [value, setValue] = useLocalStorage('my-key', 'foo');

  return (
    <div>
      <div>Value: {value}</div>
      <button onClick={() => setValue('bar')}>bar</button>
      <button onClick={() => setValue('baz')}>baz</button>
    </div>
  );
};
```
```typescript
useLocalStorage(key);
useLocalStorage(key, initialValue);
useLocalStorage(key, initialValue, raw);
```
- `key` â€” `localStorage` é”®æ¥ç®¡ç†ã€‚
- `initialValue` â€” è¦è®¾ç½®çš„åˆå§‹åŒ–å€¼ï¼Œå¦‚æœ`localStorage`ä¸­çš„å€¼ä¸ºç©ºã€‚
- `raw` â€” `boolean`ï¼Œå¦‚æœè®¾ä¸º `true`ï¼Œé’©å­å°†ä¸ä¼šå°è¯• `JSON` åºåˆ—åŒ–å­˜å‚¨çš„å€¼ã€‚

# ç®€åŒ–indexedDBçš„æ“ä½œ
è¯´äº†`sessionStorage`å’Œ`localStorage`çš„ä¼˜é›…ç”¨æ³•ï¼Œä¹Ÿæ¥è¯´è¯´å¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨`indexedDB`

## key-valueæ–¹å¼çš„ä½¿ç”¨
ä½ å¯ä»¥ç®€å•ç†è§£ä¸º`localStorage`çš„å¼‚æ­¥ç‰ˆæœ¬ã€å¯ä»¥å­˜å‚¨å¤§ä½“ç§¯æ•°æ®çš„ç‰ˆæœ¬
æœ‰è¿™æ ·ä¸€ä¸ªåº“å¯ä»¥å¸®æˆ‘ä»¬ç®€åŒ–è¿™ä¸ªæ“ä½œï¼š[localForage](https://github.com/localForage/localForage)

ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š
```typescript
import localForage from "localforage";

// ä½ çš„é¡¹ç›®ID
const PID = "your project's ID"
// å®ä¾‹
let lfInstance: LocalForage

/** åˆå§‹åŒ–LF */
export function initLFInstance(): LocalForage {
  if (!lfInstance)
    lfInstance = localforage.createInstance({ name: PID })

  return lfInstance
}

/**
 * è®¾ç½®æˆ–è¯»å–ç¼“å­˜ä¿¡æ¯, null: åˆ é™¤ï¼Œä¼ å‚ï¼šæ›´æ–°ï¼Œä¸ä¼ å‚ï¼šè·å–
 * @param key storage key
 * @param data storage data
 * @returns storage data | null
 */
export function useIndexedDB<T, K extends string>(key: K, data?: T | null): Promise<T | null> {
  if (!lfInstance) {
    console.error('lfInstance is not initialized')
    return Promise.resolve(null)
  }
  else {
    return data === null
      ? (lfInstance!.removeItem(key) as unknown as Promise<null>)
      : data === undefined
        ? lfInstance!.getItem(key)
        : lfInstance!.setItem(key, data)
  }
}
```
åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡`initLFInstance`æ–¹æ³•ï¼Œä¹‹åå°±å¯ä»¥ç”¨å°è£…å¥½çš„`useIndexedDB`æ–¹æ³•æ¥æ“ä½œ`indexedDB`äº†

## SQLçº§åˆ«çš„å­˜å‚¨æ•°æ®

è¿™ç§å¯ä»¥ç›´æ¥ç”¨åŸç”Ÿçš„å†™æ³•ä¹Ÿå¯ä»¥è€ƒè™‘ç”¨[Dexie.js](https://dexie.org)æ¥æ“ä½œï¼Œä¼šæ–¹ä¾¿å¾ˆå¤š,æ¯”å¦‚å‰é¢è¯´çš„åˆ‡æ¢ç”¨æˆ·æ•°æ®çš„ç¼“å­˜æˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªæ¥å¤„ç†ï¼š

**æ„å»ºï¼š**
```typescript
import type { Table } from 'dexie'
import Dexie from 'dexie'
import { IndexedDBKeys } from '../constant'

// ç”¨æˆ·æ•°æ®è¡¨ç±»å‹
interface IUserData {
  id?: number
  name: string
  phone: string
  age: number
}

export class AppDataDexie extends Dexie {
  userDataDB!: Table<IUserData>

  constructor() {
    super(IndexedDBKeys.UserData)
    this.version(1).stores({
      userDataDB: '++id, name, phone, age',
    })
  }
}

/** æ„å»ºDBå®ä¾‹ */
const db = new AppDataDexie()

/** å¯¼å‡ºç”¨æˆ·dbæ“ä½œ */
export const userDB = db.userDataDB
```
ä½¿ç”¨
```typescript
import { userDB } from './db'
userDB.add({ id: 1, name: 'senar', phone: 'xxxx', age: 22 })
// ...æ›´å¤šæ“ä½œå¯ä»¥æŸ¥çœ‹æ–‡æ¡£
// https://dexie.org/docs/Tutorial/Getting-started
```

# å…¶ä»–ä¸€äº›è¾¹ç•Œæ£€æµ‹

æˆ‘ä»¬å‰é¢è¯´äº†`sessionStorage`å’Œ`localStorage`æ˜¯æœ‰`5M`å®¹é‡é™åˆ¶çš„ï¼Œæˆ‘ä»¬å¦‚ä½•çŸ¥é“ç”¨æˆ·çš„ä½¿ç”¨æƒ…å†µå‘¢ï¼Ÿ

```typescript
// æ£€æµ‹localStorageä½¿ç”¨ç©ºé—´
function sieOfLS() {
  return Object.entries(localStorage).map(v => v.join('')).join('').length;
}

// æ£€æµ‹sessionStorageä½¿ç”¨ç©ºé—´
function sieOfSS() {
  return Object.entries(sessionStorage).map(v => v.join('')).join('').length;
}
```
`indexedDB`ä¹Ÿæ˜¯å¯ä»¥æ£€æµ‹å®¹é‡çš„ï¼Œå¯èƒ½åœ¨`safari`æµè§ˆå™¨ä¸Šæœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒä¸‹ï¼š
```typescript
export async function getCacheUsage() {
  const { quota, usage } = await navigator.storage.estimate()
  const remainingSpace = quota! - usage!
  const unit = 1073741824
  const text = `å·²ä½¿ç”¨ï¼š${(usage ?? 0) / unit} GB, å‰©ä½™å¯ç”¨ç¼“å­˜ç©ºé—´ï¼š${remainingSpace / unit} GB`
  console.info(text)
  return remainingSpace
}
```

# æ€»ç»“
å‰ç«¯ç¼“å­˜çš„é€‰å‹éœ€è¦è´´åˆä¸šåŠ¡åœºæ™¯æ¥é€‰æ‹©ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥äº¤æµåˆ†äº«ä¸‹è‡ªå·±é‡åˆ°è¿‡çš„ç»å…¸åœºæ™¯ï¼Œçœ‹ä½¿ç”¨å“ªç§æ–¹æ¡ˆã€å¦‚ä½•è®¾è®¡æ¯”è¾ƒå¥½


